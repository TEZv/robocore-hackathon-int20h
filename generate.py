import google.generativeai as genai
import json
import os
import time
from dotenv import load_dotenv

load_dotenv()
genai.configure(api_key=os.getenv("GEMINI_API_KEY"))

model = genai.GenerativeModel("gemini-2.5-flash")

# –ë–∞–∑–æ–≤—ñ 20 —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –∑ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–Æ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—î—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É –∫–ª—ñ—î–Ω—Ç–∞
BASE_SCENARIOS = [
    ("payment_success", "normal",
     "–ö–õ–Ü–Ñ–ù–¢: –°—Ç—Ä–∏–≤–æ–∂–µ–Ω–∏–π, –ø–∏—à–µ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Ä–µ—á–µ–Ω–Ω—è–º–∏, —Ä–æ–±–∏—Ç—å –¥—Ä—ñ–±–Ω—ñ –æ–ø–∏—Å–∫–∏ ('–Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –æ–ø–ª–∞—Ç–∞!!', '—à–æ —Ä–æ–±–∏—Ç—å?'). –ê–ì–ï–ù–¢: –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π, —à–≤–∏–¥–∫–æ —Å–∫–∏–¥–∞—î –Ω–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è."),
    ("tech_success", "normal",
     "–ö–õ–Ü–Ñ–ù–¢: –¢–µ—Ö–Ω—ñ—á–Ω–æ –Ω–µ–≥—Ä–∞–º–æ—Ç–Ω–∏–π (–±—É–º–µ—Ä), –ø–æ—è—Å–Ω—é—î '–Ω–∞ –ø–∞–ª—å—Ü—è—Ö' ('–∫—Ä—É—Ç–∏—Ç—å—Å—è –∫—Ä—É–∂–µ—á–æ–∫ —ñ –≤—Å–µ', '–≤–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–ª–∞–º–∞–ª–∞—Å—å'). –ê–ì–ï–ù–¢: –¢–µ—Ä–ø–ª—è—á–∏–π, –¥–∞—î –ø–æ–∫—Ä–æ–∫–æ–≤—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é."),
    ("access_success", "normal",
     "–ö–õ–Ü–Ñ–ù–¢: –î—É–∂–µ –ø–æ—Å–ø—ñ—à–∞—î, –ø–∏—à–µ –±–µ–∑ —Ä–æ–∑–¥—ñ–ª–æ–≤–∏—Ö –∑–Ω–∞–∫—ñ–≤ —ñ –∑ –º–∞–ª–æ—ó –ª—ñ—Ç–µ—Ä–∏ ('—à–≤–∏–¥—à–µ –¥–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –≥–æ—Ä–∏—Ç—å –ø—Ä–æ–µ–∫—Ç'). –ê–ì–ï–ù–¢: –ë–ª–∏—Å–∫–∞–≤–∏—á–Ω–æ —Å–∫–∏–¥–∞—î –∫–æ–¥ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è."),
    ("tariff_success", "normal",
     "–ö–õ–Ü–Ñ–ù–¢: –î—É–∂–µ –µ–∫–æ–Ω–æ–º–Ω–∏–π, –ø—Ä–∏—Å–∫—ñ–ø–ª–∏–≤–æ –ø–∏—Ç–∞—î –∑–∞ –∫–æ–∂–Ω—É –∫–æ–ø—ñ–π–∫—É, –±–æ—ó—Ç—å—Å—è –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂—ñ–≤. –ê–ì–ï–ù–¢: –î–µ—Ç–∞–ª—å–Ω–æ –≤—Å–µ –ø–æ—è—Å–Ω—é—î."),
    ("refund_success", "normal",
     "–ö–õ–Ü–Ñ–ù–¢: –í–≤—ñ—á–ª–∏–≤–∏–π, –∞–ª–µ –¥—É–∂–µ –∑–∞—Å–º—É—á–µ–Ω–∏–π —ñ —Ä–æ–∑—á–∞—Ä–æ–≤–∞–Ω–∏–π —è–∫—ñ—Å—Ç—é —Ç–æ–≤–∞—Ä—É. –ê–ì–ï–ù–¢: –°–ø—ñ–≤—á—É–≤–∞—î, —à–≤–∏–¥–∫–æ –æ—Ñ–æ—Ä–º–ª—é—î –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è."),
    ("other_success", "normal",
     "–ö–õ–Ü–Ñ–ù–¢: –ü–∏—à–µ –∑ –∫—É–ø–æ—é —Å–º–∞–π–ª–∏–∫—ñ–≤, –ø–∏—Ç–∞—î –≥—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏ –Ω–∞ —Å–≤—è—Ç–∞. –ê–ì–ï–ù–¢: –†–∞–¥–æ –Ω–∞–¥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é."),
    ("tech_success_pro", "normal",
     "–ö–õ–Ü–Ñ–ù–¢: –ü—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç, —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è —Å—É—Ç–æ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–º–∏ —Ç–µ—Ä–º—ñ–Ω–∞–º–∏, —Å–∫–∏–¥–∞—î –ª–æ–≥–∏ –ø–æ–º–∏–ª–∫–∏ (Error 500, CORS policy). –ê–ì–ï–ù–¢: –°–ø—ñ–ª–∫—É—î—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ."),
    ("payment_conflict", "conflict",
     "–ö–õ–Ü–Ñ–ù–¢: –î—É–∂–µ –∑–ª–∏–π, –ø–∏—à–µ –ö–ê–ü–°–û–ú, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∑–Ω–∞–∫–∏ –æ–∫–ª–∏–∫—É, –ø–æ–≥—Ä–æ–∂—É—î —Å—É–¥–æ–º –∑–∞ –ø–æ–¥–≤—ñ–π–Ω–µ —Å–ø–∏—Å–∞–Ω–Ω—è. –ê–ì–ï–ù–¢: –°—É—Ö–æ —ñ–≥–Ω–æ—Ä—É—î –ø–∏—Ç–∞–Ω–Ω—è '—Ö—Ç–æ –ø–æ–≤–µ—Ä–Ω–µ –∫–æ–º—ñ—Å—ñ—é?' (–ø–æ–º–∏–ª–∫–∞: ignored_question)."),
    ("tech_problem", "problem",
     "–ö–õ–Ü–Ñ–ù–¢: –†–æ–∑–¥—Ä–∞—Ç–æ–≤–∞–Ω–∏–π, –¥–æ–¥–∞—Ç–æ–∫ –≤–∏–ª—ñ—Ç–∞—î —Ç—Ä–µ—Ç—ñ–π –¥–µ–Ω—å –ø–æ—Å–ø—ñ–ª—å. –ê–ì–ï–ù–¢: –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–≤–µ—Ä—Ö–Ω—å–æ, –ø—Ä—è–º–æ –∑–≤–∏–Ω—É–≤–∞—á—É—î –¥–µ—à–µ–≤–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω –∫–ª—ñ—î–Ω—Ç–∞ (–ø–æ–º–∏–ª–∫–∞: rude_tone)."),
    ("tariff_problem", "problem",
     "–ö–õ–Ü–Ñ–ù–¢: –ü–∏—Ç–∞—î –ø—Ä–æ –≤–∞—Ä—Ç—ñ—Å—Ç—å —Ä—ñ—á–Ω–æ—ó –ø—ñ–¥–ø–∏—Å–∫–∏. –ê–ì–ï–ù–¢: –í–ø–µ–≤–Ω–µ–Ω–æ –Ω–∞–∑–∏–≤–∞—î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É, —Å—Ç–∞—Ä—É —Ü—ñ–Ω—É (–ø–æ–º–∏–ª–∫–∞: incorrect_info). –ö–ª—ñ—î–Ω—Ç –≤—ñ—Ä–∏—Ç—å."),
    ("access_problem", "problem",
     "–ö–õ–Ü–Ñ–ù–¢: –ù–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å SMS. –ê–ì–ï–ù–¢: –û–¥—Ä–∞–∑—É –∫–∞–∂–µ '–ø–∏—à—ñ—Ç—å –ª–∏—Å—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—É', –∑–∞–º—ñ—Å—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–æ–º–µ—Ä–∞ (–ø–æ–º–∏–ª–∫–∞: unnecessary_escalation)."),
    ("refund_conflict", "conflict",
     "–ö–õ–Ü–Ñ–ù–¢: –í–∏–º–∞–≥–∞—î –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è (–ø—Ä–æ–π—à–ª–æ 10 –¥–Ω—ñ–≤). –ê–ì–ï–ù–¢: –ì—Ä—É–±–æ –≤—ñ–¥–º–æ–≤–ª—è—î –±–µ–∑ –∂–æ–¥–Ω–∏—Ö –ø–æ—è—Å–Ω–µ–Ω—å –ø—Ä–∏—á–∏–Ω–∏ (–ø–æ–º–∏–ª–∫–∞: rude_tone)."),
    ("payment_problem_2", "problem",
     "–ö–õ–Ü–Ñ–ù–¢: –ì—Ä–æ—à—ñ —Å–ø–∏—Å–∞–ª–æ, –∞ –ø–æ—Å–ª—É–≥–∏ –Ω–µ–º–∞, –ø–∞–Ω—ñ–∫—É—î. –ê–ì–ï–ù–¢: –í—ñ–¥–ø–∏—Å—É—î —à–∞–±–ª–æ–Ω–Ω–æ '—á–µ–∫–∞–π—Ç–µ' —ñ –º–∏—Ç—Ç—î–≤–æ –∑–∞–∫—Ä–∏–≤–∞—î —á–∞—Ç (–ø–æ–º–∏–ª–∫–∞: no_resolution)."),
    ("hidden_dissatisfaction_1", "easter_egg",
     "–ö–õ–Ü–Ñ–ù–¢: –°–∫–∞—Ä–∂–∏—Ç—å—Å—è –Ω–∞ –ø–æ–≤—ñ–ª—å–Ω–∏–π —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç. –ê–ì–ï–ù–¢: –°–∫–∏–¥–∞—î –ª—ñ–Ω–∫ –Ω–∞ 100-—Å—Ç–æ—Ä—ñ–Ω–∫–æ–≤—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –ö–õ–Ü–Ñ–ù–¢: '–Ø—Å–Ω–æ, —Å–∞–º —Ä–æ–∑–±–µ—Ä—É—Å—å. –î—è–∫—É—é.' (–ø—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤–∏—Ä—ñ—à–µ–Ω–∞)."),
    ("hidden_dissatisfaction_2", "easter_egg",
     "–ö–õ–Ü–Ñ–ù–¢: –ß–æ–º—É –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤ –ø—Ä–æ–º–æ–∫–æ–¥? –ê–ì–ï–ù–¢: –ö–∞–∂–µ –∞–∫—Ü—ñ—è –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å (–±—Ä–µ—Ö–Ω—è, incorrect_info). –ö–õ–Ü–Ñ–ù–¢: '–ù—É –æ–∫–µ–π, —Ö–∞–π –±—É–¥–µ –±–µ–∑ –∑–Ω–∏–∂–∫–∏, –¥–æ –ø–æ–±–∞—á–µ–Ω–Ω—è' (–ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–∑–∞)."),
    ("hidden_dissatisfaction_3", "easter_egg",
     "–ö–õ–Ü–Ñ–ù–¢: –•–æ—á–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ—à—Ç—É. –ê–ì–ï–ù–¢: '–Ø —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç –Ω–∞ –∞–¥–º—ñ–Ω—ñ–≤, —á–µ–∫–∞–π—Ç–µ 5 –¥–Ω—ñ–≤' (unnecessary_escalation). –ö–õ–Ü–Ñ–ù–¢: '–î–æ–±—Ä–µ, –±—É–¥—É —á–µ–∫–∞—Ç–∏, –¥—è–∫—É—é'."),
    ("mixed_tariff", "normal",
     "–ö–õ–Ü–Ñ–ù–¢: –°—Ç—É–¥–µ–Ω—Ç, —à—É–∫–∞—î —Ö–∞–ª—è–≤—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–æ–ª–æ–¥—ñ–∂–Ω–∏–π —Å–ª–µ–Ω–≥ ('–∫—Ä—ñ–Ω–∂', '—á—ñ–ª–∏—Ç–∏'). –ê–ì–ï–ù–¢: –ü—ñ–¥–±–∏—Ä–∞—î –º–æ–ª–æ–¥—ñ–∂–Ω–∏–π —Ç–∞—Ä–∏—Ñ."),
    ("mixed_other", "problem",
     "–ö–õ–Ü–Ñ–ù–¢: –ü–∏—Ç–∞—î, —è–∫ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–∏—Ç–∏ —Å–≤—ñ–π –∞–∫–∞—É–Ω—Ç. –ê–ì–ï–ù–¢: –ü–æ–≤–Ω—ñ—Å—Ç—é —ñ–≥–Ω–æ—Ä—É—î –ø–∏—Ç–∞–Ω–Ω—è —ñ –Ω–∞–≤'—è–∑—É—î –∑–Ω–∏–∂–∫—É 50% (–ø–æ–º–∏–ª–∫–∞: ignored_question)."),
    ("mixed_refund", "easter_egg",
     "–ö–õ–Ü–Ñ–ù–¢: –ì—Ä–æ—à—ñ –∑–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–µ –ø—Ä–∏–π—à–ª–∏ –Ω–∞ 5 –¥–µ–Ω—å. –ê–ì–ï–ù–¢: '–¶–µ –ø—Ä–æ–±–ª–µ–º–∞ –≤–∞—à–æ–≥–æ –±–∞–Ω–∫—É' (rude_tone + no_resolution). –ö–õ–Ü–Ñ–ù–¢: '–ó—Ä–æ–∑—É–º—ñ–ª–æ, –ø—ñ–¥—É —Å–≤–∞—Ä–∏—Ç–∏—Å—å –∑ –±–∞–Ω–∫–æ–º, –¥–æ –ø–æ–±–∞—á–µ–Ω–Ω—è'."),
    ("mixed_tech", "conflict",
     "–ö–õ–Ü–Ñ–ù–¢: –ê–≥—Ä–µ—Å–∏–≤–Ω–∏–π, —á–µ—Ä–µ–∑ –≤–∞—à –±–∞–≥ –≤—Ç—Ä–∞—Ç–∏–≤ –≥—Ä–æ—à—ñ. –ê–ì–ï–ù–¢: –ó–∞–º—ñ—Å—Ç—å –≤–∏–±–∞—á–µ–Ω—å –ø–æ—á–∏–Ω–∞—î –∞–≥—Ä–µ—Å–∏–≤–Ω–æ —Å–ø–µ—Ä–µ—á–∞—Ç–∏—Å—è (–ø–æ–º–∏–ª–∫–∞: rude_tone).")
]

# –°—Ç–≤–æ—Ä—é—î–º–æ 40 —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤, –ø—Ä–æ–≥–∞–Ω—è—é—á–∏ –±–∞–∑–æ–≤—ñ –¥–≤—ñ—á—ñ –∑ —Ä—ñ–∑–Ω–∏–º–∏ ID
SCENARIOS = []
for i in range(2):
    for s_id, s_type, s_desc in BASE_SCENARIOS:
        SCENARIOS.append((f"{s_id}_v{i + 1}", s_type, s_desc))

# --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ë–ê–¢–ß–Ü–í ---
BATCH_SIZE = 20  # –¢–≤–æ—ó –∫–æ–ª–µ–≥–∏ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω–∏—Ç–∏ —Ü–µ —á–∏—Å–ª–æ, —è–∫—â–æ –∑–∞—Ö–æ—á—É—Ç—å


def generate_batch(batch_scenarios, batch_num):
    prompt = f"""–¢–∏ - –º–∞–π—Å—Ç–µ—Ä —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—É–ø–µ—Ä-—Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏—Ö –¥—ñ–∞–ª–æ–≥—ñ–≤ –¥–ª—è —Å–ª—É–∂–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏.
–¢–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è: –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ {len(batch_scenarios)} —Ä—ñ–∑–Ω–∏—Ö —á–∞—Ç—ñ–≤ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.

–ö–†–ò–¢–ò–ß–ù–ê –í–ò–ú–û–ì–ê –î–û –†–ï–ê–õ–Ü–°–¢–ò–ß–ù–û–°–¢–Ü –ö–õ–Ü–Ñ–ù–¢–Ü–í:
–ö–ª—ñ—î–Ω—Ç–∏ –ù–ï –ü–û–í–ò–ù–ù–Ü –±—É—Ç–∏ —ñ–¥–µ–∞–ª—å–Ω–∏–º–∏ —á–∏ —à—Ç—É—á–Ω–æ –≤–≤—ñ—á–ª–∏–≤–∏–º–∏. –Ø–∫—â–æ –≤ –æ–ø–∏—Å—ñ —Å–∫–∞–∑–∞–Ω–æ "–∑–ª–∏–π" ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∞–≥—Ä–µ—Å—ñ—é —ñ –∫–∞–ø—Å–ª–æ–∫. –Ø–∫—â–æ "–ø–æ—Å–ø—ñ—à–∞—î" ‚Äî –ø–∏—à–∏ –±–µ–∑ —Ä–æ–∑–¥—ñ–ª–æ–≤–∏—Ö –∑–Ω–∞–∫—ñ–≤. –î–æ–¥–∞–≤–∞–π –¥—Ä—ñ–±–Ω—ñ –æ–¥—Ä—É–∫–∏, —Å–ª–µ–Ω–≥, —Ä—É—Å–∏–∑–º–∏ (—è–∫—â–æ –¥–æ—Ä–µ—á–Ω–æ), –ø–æ–∫–∞–∑—É–π –∂–∏–≤—ñ –µ–º–æ—Ü—ñ—ó. –ê–≥–µ–Ω—Ç –ø—Ä–∏ —Ü—å–æ–º—É —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è –∑–≥—ñ–¥–Ω–æ –∑—ñ —Å–≤–æ—ó–º –æ–ø–∏—Å–æ–º.

–ü–æ–≤–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –í–ò–ö–õ–Æ–ß–ù–û —É —Ñ–æ—Ä–º–∞—Ç—ñ –≤–∞–ª—ñ–¥–Ω–æ–≥–æ JSON-–º–∞—Å–∏–≤—É. –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
[
  {{
    "id": "–Ω–∞–∑–≤–∞_—Å—Ü–µ–Ω–∞—Ä—ñ—é",
    "type": "—Ç–∏–ø_—Å—Ü–µ–Ω–∞—Ä—ñ—é",
    "messages": [
      {{"role": "client", "text": "–∂–∏–≤–∞ —Ä–µ–ø–ª—ñ–∫–∞"}},
      {{"role": "agent", "text": "—Ä–µ–ø–ª—ñ–∫–∞"}}
    ]
  }}
]

–û—Å—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:
"""
    for i, (s_id, s_type, s_desc) in enumerate(batch_scenarios):
        prompt += f"\n–ß–ê–¢ {i + 1}:\n- id: {s_id}\n- type: {s_type}\n- –û–ø–∏—Å: {s_desc}\n"

    # –î–æ–¥–∞—î–º–æ –º–µ—Ö–∞–Ω—ñ–∑–º —Å–∞–º–æ–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è (–º–∞–∫—Å–∏–º—É–º 3 —Å–ø—Ä–æ–±–∏ –Ω–∞ –ø–∞–∫–µ—Ç)
    max_retries = 3
    for attempt in range(max_retries):
        try:
            print(f"  –í—ñ–¥–ø—Ä–∞–≤–ª—è—é –∑–∞–ø–∏—Ç –¥–æ Gemini (–ü–∞–∫–µ—Ç {batch_num}, —Å–ø—Ä–æ–±–∞ {attempt + 1})...")
            response = model.generate_content(
                prompt,
                generation_config=genai.GenerationConfig(
                    temperature=0.85,
                    response_mime_type="application/json"  # –ñ–æ—Ä—Å—Ç–∫–æ –≤–∏–º–∞–≥–∞—î–º–æ JSON –Ω–∞ —Ä—ñ–≤–Ω—ñ API!
                )
            )

            raw = response.text.strip()
            if raw.startswith("```"):
                raw = raw.split("```")[1]
                if raw.startswith("json"):
                    raw = raw[4:]

            # –ù–∞–º–∞–≥–∞—î–º–æ—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ JSON. –Ø–∫—â–æ —É—Å–ø—ñ—à–Ω–æ - –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ñ –≤–∏—Ö–æ–¥–∏–º–æ –∑ —Ü–∏–∫–ª—É
            return json.loads(raw.strip())

        except json.JSONDecodeError as e:
            print(f"  ‚ö†Ô∏è Gemini –∑–ª–∞–º–∞–ª–∞ —Ñ–æ—Ä–º–∞—Ç JSON. –ü—Ä–æ–±—É—î–º–æ —â–µ —Ä–∞–∑... (–î–µ—Ç–∞–ª—ñ: {e})")
            time.sleep(3)  # –ö–æ—Ä–æ—Ç–∫–∞ –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ—é —Å–ø—Ä–æ–±–æ—é

    # –Ø–∫—â–æ –≤—Å—ñ 3 —Å–ø—Ä–æ–±–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—è
    raise Exception(f"–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞–ª—ñ–¥–Ω–∏–π JSON –¥–ª—è –ø–∞–∫–µ—Ç—É {batch_num} –ø—ñ—Å–ª—è {max_retries} —Å–ø—Ä–æ–±.")

def main():
    print(f"üöÄ –ü–æ—á–∏–Ω–∞—î–º–æ –ø–∞–∫–µ—Ç–Ω—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é {len(SCENARIOS)} —á–∞—Ç—ñ–≤!")
    all_chats = []

    # –°–ø—Ä–∞–≤–∂–Ω—è –º–∞–≥—ñ—è: —Ä–æ–∑–±–∏–≤–∞—î–º–æ –±—É–¥—å-—è–∫—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –Ω–∞ –ø–∞–∫—É–Ω–∫–∏ –ø–æ 20
    batches = [SCENARIOS[i:i + BATCH_SIZE] for i in range(0, len(SCENARIOS), BATCH_SIZE)]

    for idx, batch in enumerate(batches):
        print(
            f"\nüì¶ –û–±—Ä–æ–±–∫–∞ –ø–∞–∫–µ—Ç—É {idx + 1}/{len(batches)} (–î—ñ–∞–ª–æ–≥–∏ {idx * BATCH_SIZE + 1} - {idx * BATCH_SIZE + len(batch)})...")
        try:
            chats = generate_batch(batch, idx + 1)
            all_chats.extend(chats)
            print(f"  ‚úÖ –ü–∞–∫–µ—Ç {idx + 1} —É—Å–ø—ñ—à–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ!")

            # –ü–∞—É–∑–∞ –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏, —â–æ–± –Ω–µ –¥—Ä–∞—Ç—É–≤–∞—Ç–∏ Google
            if idx < len(batches) - 1:
                print("  ‚è≥ –ü–∞—É–∑–∞ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –ø–∞–∫–µ—Ç–æ–º...")
                time.sleep(10)
        except Exception as e:
            print(f"  ‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –ø–∞–∫–µ—Ç—ñ {idx + 1}: {e}")

    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å—ñ –±–∞—Ç—á—ñ –≤ –æ–¥–∏–Ω —Å–ø—ñ–ª—å–Ω–∏–π —Ñ–∞–π–ª
    with open("dataset.json", "w", encoding="utf-8") as f:
        json.dump(all_chats, f, ensure_ascii=False, indent=2)

    print(f"\n‚úÖ –ì–û–¢–û–í–û! –ó–±–µ—Ä–µ–∂–µ–Ω–æ {len(all_chats)} –¥—ñ–∞–ª–æ–≥—ñ–≤ —É dataset.json")


if __name__ == "__main__":
    main()