import google.generativeai as genai
import json
import os
from dotenv import load_dotenv

load_dotenv()
genai.configure(api_key=os.getenv("GEMINI_API_KEY"))
model = genai.GenerativeModel("gemini-2.5-flash")

# --- –ü–†–û–ú–ü–¢–ò –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ —á–∞—Ç—ñ–≤ ---

SCENARIOS = [
    # (–Ω–∞–∑–≤–∞, —Ç–∏–ø, –ø—Ä–æ–º–ø—Ç)
    ("payment_issue", "normal", """
–ó–≥–µ–Ω–µ—Ä—É–π —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–æ–º —ñ –∞–≥–µ–Ω—Ç–æ–º.
–¢–µ–º–∞: –ü—Ä–æ–±–ª–µ–º–∞ –∑ –æ–ø–ª–∞—Ç–æ—é (–∫–∞—Ä—Ç–∫–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å).
–ê–≥–µ–Ω—Ç –≤–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º—É —É—Å–ø—ñ—à–Ω–æ —ñ –≤–≤—ñ—á–ª–∏–≤–æ.
–ö–ª—ñ—î–Ω—Ç –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),
    
    ("tech_error", "normal", """
–ó–≥–µ–Ω–µ—Ä—É–π —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏.
–¢–µ–º–∞: –¢–µ—Ö–Ω—ñ—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ (–¥–æ–¥–∞—Ç–æ–∫ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è).
–ê–≥–µ–Ω—Ç –¥–æ–ø–æ–º–∞–≥–∞—î –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º.
–ö–ª—ñ—î–Ω—Ç –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),

    ("account_access", "normal", """
–ó–≥–µ–Ω–µ—Ä—É–π —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏.
–¢–µ–º–∞: –î–æ—Å—Ç—É–ø –¥–æ –∞–∫–∞—É–Ω—Ç—É (–∑–∞–±—É—Ç–∏–π –ø–∞—Ä–æ–ª—å).
–ê–≥–µ–Ω—Ç –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–æ–ø–æ–º–∞–≥–∞—î.
–ö–ª—ñ—î–Ω—Ç –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),

    ("tariff_question", "normal", """
–ó–≥–µ–Ω–µ—Ä—É–π —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏.
–¢–µ–º–∞: –ü–∏—Ç–∞–Ω–Ω—è –ø–æ —Ç–∞—Ä–∏—Ñ—É (—â–æ –≤—Ö–æ–¥–∏—Ç—å –≤ –ø–ª–∞–Ω).
–ê–≥–µ–Ω—Ç –¥–∞—î –ø–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.
–ö–ª—ñ—î–Ω—Ç –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),

    ("refund", "normal", """
–ó–≥–µ–Ω–µ—Ä—É–π —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏.
–¢–µ–º–∞: –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤.
–ê–≥–µ–Ω—Ç —É—Å–ø—ñ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª—é—î –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è.
–ö–ª—ñ—î–Ω—Ç –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),

    # --- –ö–û–ù–§–õ–Ü–ö–¢–ù–Ü –ö–ï–ô–°–ò ---
    ("payment_conflict", "conflict", """
–ó–≥–µ–Ω–µ—Ä—É–π —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–Ω–∏–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏.
–¢–µ–º–∞: –ü—Ä–æ–±–ª–µ–º–∞ –∑ –æ–ø–ª–∞—Ç–æ—é. –ö–ª—ñ—î–Ω—Ç –∑–ª–∏–π, –∞–≥–µ–Ω—Ç –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∞–ª–µ –∫–ª—ñ—î–Ω—Ç –Ω–µ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π.
–ê–≥–µ–Ω—Ç —Ä–æ–±–∏—Ç—å –ø–æ–º–∏–ª–∫—É: —ñ–≥–Ω–æ—Ä—É—î –æ–¥–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞ (ignored_question).
–ö–ª—ñ—î–Ω—Ç –Ω–µ–∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),

    ("rude_agent", "problem", """
–ó–≥–µ–Ω–µ—Ä—É–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –¥–µ –∞–≥–µ–Ω—Ç –≤–µ–¥–µ —Å–µ–±–µ –≥—Ä—É–±–æ —ñ –Ω–µ—Ç–µ—Ä–ø–ª—è—á–µ.
–¢–µ–º–∞: –¢–µ—Ö–Ω—ñ—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞.
–ê–≥–µ–Ω—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î rude_tone ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ä—ñ–∑–∫–æ, –±–µ–∑ –ø–æ–≤–∞–≥–∏.
–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤–∏—Ä—ñ—à–µ–Ω–∞ (no_resolution).
–ö–ª—ñ—î–Ω—Ç –¥—É–∂–µ –Ω–µ–∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),

    ("wrong_info", "problem", """
–ó–≥–µ–Ω–µ—Ä—É–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –¥–µ –∞–≥–µ–Ω—Ç –¥–∞—î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.
–¢–µ–º–∞: –ü–∏—Ç–∞–Ω–Ω—è –ø–æ —Ç–∞—Ä–∏—Ñ—É.
–ê–≥–µ–Ω—Ç –≤–ø–µ–≤–Ω–µ–Ω–æ –¥–∞—î incorrect_info ‚Äî –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–æ —Ü—ñ–Ω–∏.
–ö–ª—ñ—î–Ω—Ç –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π (–Ω–µ –∑–Ω–∞—î —â–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞).
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),

    # --- –ü–ê–°–•–ê–õ–ö–ò: –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ –Ω–µ–∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—å ---
    ("hidden_dissatisfaction_1", "easter_egg", """
–ó–≥–µ–Ω–µ—Ä—É–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∑ –ü–†–ò–•–û–í–ê–ù–û–Æ –Ω–µ–∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—é.
–¢–µ–º–∞: –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤.
–í–ê–ñ–õ–ò–í–û: –ö–ª—ñ—î–Ω—Ç –≤ –∫—ñ–Ω—Ü—ñ –∫–∞–∂–µ "–¥—è–∫—É—é" —ñ "–∑—Ä–æ–∑—É–º—ñ–ª–æ", –∞–ª–µ –ø—Ä–æ–±–ª–µ–º–∞ –ù–ê–°–ü–†–ê–í–î–Ü –Ω–µ –≤–∏—Ä—ñ—à–µ–Ω–∞.
–ê–≥–µ–Ω—Ç –æ–±—ñ—Ü—è—î –∞–ª–µ –Ω–µ —Ä–æ–±–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –¥—ñ–π (no_resolution).
–ù–∞ –ø–æ–≤–µ—Ä—Ö–Ω—ñ –∑–¥–∞—î—Ç—å—Å—è —â–æ –≤—Å–µ –æ–∫, –∞–ª–µ —É–≤–∞–∂–Ω–∏–π —á–∏—Ç–∞—á –±–∞—á–∏—Ç—å —â–æ –∫–ª—ñ—î–Ω—Ç –Ω–µ –æ—Ç—Ä–∏–º–∞–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),

    ("hidden_dissatisfaction_2", "easter_egg", """
–ó–≥–µ–Ω–µ—Ä—É–π —á–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∑ –ü–†–ò–•–û–í–ê–ù–û–Æ –Ω–µ–∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—é.
–¢–µ–º–∞: –î–æ—Å—Ç—É–ø –¥–æ –∞–∫–∞—É–Ω—Ç—É.
–í–ê–ñ–õ–ò–í–û: –ö–ª—ñ—î–Ω—Ç —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à—É—î —á–∞—Ç –ø–æ–∑–∏—Ç–∏–≤–Ω–æ ("–¥–æ–±—Ä–µ, –∑—Ä–æ–∑—É–º—ñ–≤"), 
–∞–ª–µ –º—ñ–∂ —Ä—è–¥–∫—ñ–≤ –≤–∏–¥–Ω–æ —â–æ –≤—ñ–Ω –Ω–µ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–∞, –Ω–µ –≤–∏—Ä—ñ—à–µ–Ω–∞.
–ê–≥–µ–Ω—Ç –∑—Ä–æ–±–∏–≤ unnecessary_escalation ‚Äî –ø–µ—Ä–µ–≤—ñ–≤ –Ω–∞ —ñ–Ω—à–∏–π –≤—ñ–¥–¥—ñ–ª –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏.
–§–æ—Ä–º–∞—Ç: JSON –º–∞—Å–∏–≤ [{"role": "client", "text": "..."}, {"role": "agent", "text": "..."}]
–ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –¢—ñ–ª—å–∫–∏ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å.
"""),
]


def generate_chat(scenario_name: str, scenario_type: str, prompt: str) -> dict:
    """–ì–µ–Ω–µ—Ä—É—î –æ–¥–∏–Ω –¥—ñ–∞–ª–æ–≥ —á–µ—Ä–µ–∑ Gemini API."""
    print(f"  –ì–µ–Ω–µ—Ä—É—é: {scenario_name}...")
    
    response = model.generate_content(
        prompt,
        generation_config=genai.GenerationConfig(temperature=0.9)
        # –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó - –≤–∏—Å–æ–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ = –±—ñ–ª—å—à–µ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω–æ—Å—Ç—ñ
    )
    
    # –û—á–∏—â–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ –º–æ–∂–ª–∏–≤–∏—Ö markdown —Å–∏–º–≤–æ–ª—ñ–≤
    raw = response.text.strip()
    if raw.startswith("```"):
        raw = raw.split("```")[1]
        if raw.startswith("json"):
            raw = raw[4:]
    raw = raw.strip()
    
    messages = json.loads(raw)
    
    return {
        "id": scenario_name,
        "type": scenario_type,
        "messages": messages
    }


def main():
    print("üöÄ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞—Ç–∞—Å–µ—Ç—É —á–∞—Ç—ñ–≤...")
    dataset = []
    
    for scenario_name, scenario_type, prompt in SCENARIOS:
        try:
            chat = generate_chat(scenario_name, scenario_type, prompt)
            dataset.append(chat)
            print(f"  ‚úÖ {scenario_name} ‚Äî OK")
        except Exception as e:
            print(f"  ‚ùå {scenario_name} ‚Äî ERROR: {e}")
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ JSON
    with open("dataset.json", "w", encoding="utf-8") as f:
        json.dump(dataset, f, ensure_ascii=False, indent=2)
    
    print(f"\n‚úÖ –ì–æ—Ç–æ–≤–æ! –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ {len(dataset)} –¥—ñ–∞–ª–æ–≥—ñ–≤ ‚Üí dataset.json")


if __name__ == "__main__":
    main()
